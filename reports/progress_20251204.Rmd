---
title: "卒論進捗まとめ（2025-12-04）"
author: "Kota Yamamoto"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(fixest)
library(arrow)
library(dplyr)

reg_dt <- arrow::read_parquet("../data/processed/adm2_reg_2019_2024.parquet")
```

# 研究の目的

目的：インドネシア ADM2 レベルで構築した Global Forest Watch の integrated deforestation alerts（以下 alerts）と、同じ地域・年の森林減少（forest loss, defor_rate）と因果関係を検証する。

インドネシアにおけるalertsデータの妥当性と、その限界を明らかにする


# データ構築と記述統計
- 対象：インドネシア ADM2 × 2019–2024 年

- 元データソース（Google Earth Engine）
  - integrated deforestation alerts（GFW Integrated Alerts）
  - forest loss（Global Forest Change / GFW）
  - 降水量（CHIRPS）
  - 焼失面積（burned area）
  - 雲量（Sentinel-2 Cloud Probability）
  
## ADM2の概観
```{r adm2_map, echo=FALSE, message=FALSE, warning=FALSE}
library(sf)
library(ggplot2)

# シェープファイルの読み込み
adm2 <- st_read("../data/raw/IDN_adm2_gaul2015/IDN_adm2_gaul2015.shp")

# ADM2 の境界を描画
ggplot(adm2) +
  geom_sf(size = 0.1) +
  theme_void() +
  ggtitle("Indonesia ADM2 (GAUL 2015)")
```

## データの整形
Google Earth engine上で ADM2×年単位に集計

↓

ローカルに CSV としてエクスポート

↓

`scripts/02_*.R` から `scripts/08_*.R` で前処理・結合

↓

最終的に`data/processed/adm2_reg_2019_2024.parquet`（ADM2×年のパネル）を作成

## 主な変数

- `defor_rate`：森林減少率（forest loss / 初期森林面積）
- `ln_loss`：森林損失面積（loss_ha）の log1p
- `ln_alerts`：integrated alerts 面積（ha）の log1p
- `cloud_share`：雲天ピクセル比率（年平均）
- `chirps_mm`：年降水量（mm）
- `burned_ha`：焼失面積（ha）


## データ
```{r, echo=FALSE}
reg_dt <- arrow::read_parquet("../data/processed/adm2_reg_2019_2024.parquet")
head(reg_dt)
```



## 主要な図

### 森林減少率の空間分布（例：2019 年）
```{r defor spatial distributuon, echo=FALSE, out.width="80%"}
knitr::include_graphics("../outputs/figures/choropleth/defor/map_defor_rate_2019.png")
```

2019 年時点では、特にカリマンタン島とスマトラ島の一部 ADM2 で defor_rate が高く、
ジャワ島では森林減少がほとんど観測されない。

### alerts の空間分布（例：2019 年）
```{r alerts spatial distributuon, echo=FALSE, out.width="80%"}
knitr::include_graphics("../outputs/figures/choropleth/alerts/map_ha_alerts_2019.png")
```

### cloud_share と ln_alerts の散布図（操作変数の妥当性?）
```{r scatter clouds alerts, echo=FALSE, out.width="80%"}
knitr::include_graphics("../outputs/figures/scatter/scatter_cloud_share_vs_ln_alerts.png")
```

雲量シェアが高いほど ln_alerts が低くなる負の相関が見られ、cloud_share が alerts の観測可能性に影響していることを示唆。
(後の分析でcloud_share の t ≈ -2.4（F ≈ 5.8）で弱い操作変数とわかる)


# 分析
## Baseline OLS
### Model FE OLS
ベースラインの固定効果付き回帰式は次の通り
$$
defor\_rate_{it}
= \beta_1 \ln(alerts_{it}+1)
+ \beta_2 \,chirps\_mm_{it}
+ \beta_3 \,burned\_ha_{it}
+ \alpha_i + \lambda_t + u_{it},
$$

```{r Baseline_OLS, echo=FALSE}
ols_defor <- feols(
  defor_rate ~ ln_alerts + chirps_mm + burned_ha |
    adm2_code + year,
  data    = reg_dt,
  cluster = ~adm2_code
)

summary(ols_defor)
```

### 解釈
- ln_alerts：0.000283（p≈0.13）
アラート面積が増えるほど defor_rate は増える方向ですが、統計的に有意でない。
→ 「alerts が多いほど森林減少率が高い」という関係は、はっきりとは確認できない。

- chirps_mm：-0.00000220（p≈0.029）
降水量が多い地域ほど defor_rate が有意に低い。
→ 雨が多いと森林減少が抑えられている（または起きにくい）傾向。

- burned_ha：ほぼ 0（p≈0.99）
焼失面積は、この仕様では defor_rate とほとんど関係が見られない。


## 2SLS first stage
### Model
$$
\ln(alerts_{it} + 1)
= \beta_1 \,cloud\_share_{it}
+ \beta_2 \,chirps\_mm_{it}
+ \beta_3 \,burned\_ha_{it}
+ \alpha_i + \lambda_t + v_{it}.
$$

```{r 2SLS first_stage, echo=FALSE}
fs_ln_alerts <- feols(
  ln_alerts ~ cloud_share + chirps_mm + burned_ha |
    adm2_code + year,
  data    = reg_dt,
  cluster = ~adm2_code
)

summary(fs_ln_alerts)
```

### 解釈
- ln_alerts：0.000283（p≈0.13）
アラート面積が増えるほど defor_rate は増える方向ですが、統計的に有意でない
→ 「alerts が多いほど森林減少率が高い」という関係は、はっきりとは確認できない

- chirps_mm：-0.00000220（p≈0.029）
降水量が多い地域ほど defor_rate が有意に低い。
→ 雨が多いと森林減少が抑えられている（または起きにくい）傾向。

- burned_ha：ほぼ 0（p≈0.99）
焼失面積は、この仕様では defor_rate とほとんど関係が見られない。


## 2SLS second stage
### model
$$
defor\_rate_{it}
= \beta_1 \,\widehat{\ln(alerts_{it}+1)}
+ \beta_1 \,chirps\_mm_{it}
+ \beta_1 \,burned\_ha_{it}
+ \alpha_i + \lambda_t + \varepsilon_{it}.
$$

```{r 2SLS_second_stage, echo=FALSE}
iv_defor <- feols(
  defor_rate ~ chirps_mm + burned_ha |   # 外生のコントロール
    adm2_code + year |                   # 固定効果
    ln_alerts ~ cloud_share,             # 内生 ~ IV
  data    = reg_dt,
  cluster = ~adm2_code
)

summary(iv_defor)

```

### 解釈
- ln_alerts：0.000283（p≈0.13）
アラート面積が増えるほど defor_rate は増える方向ですが、統計的に有意でない。
→ 「alerts が多いほど森林減少率が高い」という関係は、はっきりとは確認できない。

- chirps_mm：-0.00000220（p≈0.029）
降水量が多い地域ほど defor_rate が有意に低い。
→ 雨が多いと森林減少が抑えられている（または起きにくい）傾向。

- burned_ha：ほぼ 0（p≈0.99）
焼失面積は、この仕様では defor_rate とほとんど関係が見られない。



# 技術的な限界と問題点
## データの限界
・Assunção et al. (2023)はデータは自治体×月の長期パネルを使用
・本研究は ADM2×年で 2019–2024 の 6 年のみ。

## 現時点の問題点
・cloud_share の first-stage F ≈ 5.8 と弱く、2SLS の推定値は不安定。
・cloud_share が気候条件と密接に結び付いており、排除制限が強くはない可能性。
・コントロールは降水・burned areaに限られ、政策・土地利用・価格ショックなどを十分に捉えていない。


# 今後の改善案
## ラグの導入
### 何をラグさせるか

・アウトカム：defor_rate_it, ln_loss_it
・説明変数：$ln_alerts_{i,t-1}$（前年のアラート）
・操作変数：$cloud_share_{i,t-1}$（前年の雲量）
という形で、
$$
defor\_rate_{it} = βln(alerts_{i,t−1}+1) + controls_{it} + α_i + λ_t + ε_{it}
$$


あるいは 2SLS なら
$$
2 段目： defor\_rate_{it} \sim ln\_alerts_{i,t-1}
1 段目： ln\_alerts_{i,t-1} \sim cloud\_share_{i,t-1}
$$

### ラグの意味
・伐採 → 衛星検知 → 年次 loss 反映 にはタイムラグがある可能性が高い。「前年 alerts が翌年 loss / rate にどうつながるか」を見る
・同期的な逆因果（deforestation が多い年にだけ alerts を増やす）を少し弱められる？


## 政策（enforcement）に近い変数を導入する
インドネシアで利用可能な政策・制度の変数が取れるなら、以下のような強化が考えられる

### 現実的に検討できそうな候補
保護区・保全林（protected areas, conservation forest）比率
・ADM2 内の protected area 面積シェア（固定的な cross-section）を計算し、
・これと year を交差させたダミー（high-PA × post-2019）などを入れる。

### どう使うか
コントロール or 交互作用項 として回帰式に入れる


## 集計頻度を上げる

### 月次・四半期集計のメリット
雲量と alerts の「観測タイミング」の連動をより精密に捉えられる。
first stage が強くなる可能性がある（雲の短期ショックが効いてくる）。

### 実務的な課題
今のパイプラインは ADM2×「年」単位で GEE→CSV→parquet を設計しているので、月次にすると
・GEE のコードを ADM2×month 出力に全面書き換え
・R 側の 02_, 03_ スクリプトも全て修正
・データ量・計算負荷も増加
卒論の残り時間とのトレードオフが大きい





